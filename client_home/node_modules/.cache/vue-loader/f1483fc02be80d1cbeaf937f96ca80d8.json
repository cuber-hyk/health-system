{"remainingRequest":"C:\\Users\\bishe\\Desktop\\springboot专利管理系统[编号：CS781820_20220828094342] (4)\\client_home\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\bishe\\Desktop\\springboot专利管理系统[编号：CS781820_20220828094342] (4)\\client_home\\src\\views\\goods\\details.vue?vue&type=style&index=0&id=10dbac5f&scoped=true&lang=css&","dependencies":[{"path":"C:\\Users\\bishe\\Desktop\\springboot专利管理系统[编号：CS781820_20220828094342] (4)\\client_home\\src\\views\\goods\\details.vue","mtime":1675233590000},{"path":"C:\\Users\\bishe\\Desktop\\springboot专利管理系统[编号：CS781820_20220828094342] (4)\\client_home\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\bishe\\Desktop\\springboot专利管理系统[编号：CS781820_20220828094342] (4)\\client_home\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\bishe\\Desktop\\springboot专利管理系统[编号：CS781820_20220828094342] (4)\\client_home\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\bishe\\Desktop\\springboot专利管理系统[编号：CS781820_20220828094342] (4)\\client_home\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\bishe\\Desktop\\springboot专利管理系统[编号：CS781820_20220828094342] (4)\\client_home\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5jYXJkX2JvdHRvbV9nb29kcyB7CiAgbWFyZ2luLXRvcDogNjBweDsKICBwYWRkaW5nOiA1cHg7CiAgYm9yZGVyOiAxcHggc29saWQgI2VlZTsKfQoub3B0aW9ucyB7CiAgZm9udC1zaXplOiAyMHB4OwogIHBhZGRpbmc6IDE1cHggMDsKICBib3JkZXItYm90dG9tOiAxcHggc29saWQgI2VlZTsKfQoub3B0aW9ucyBzcGFuIHsKICBjdXJzb3I6IHBvaW50ZXI7CiAgcGFkZGluZy1yaWdodDogNDBweDsKICBmb250LXdlaWdodDogNjAwOwp9Ci5vcHRpb25zIHNwYW4uc2VsZWN0ZWQgewogIGNvbG9yOiB2YXIoLS1jb2xvcl9wcmltYXJ5KTsKfQoub3B0aW9ucyBzcGFuOmhvdmVyIHsKICBjb2xvcjogdmFyKC0tY29sb3JfcHJpbWFyeSk7Cn0KLmZvcm1fZWRpdG9yIHsKICBwYWRkaW5nOiAxMHB4Owp9Ci5jb21tZW50X2JveCB7CiAgZGlzcGxheTogZmxleDsKICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7Cn0K"},{"version":3,"sources":["details.vue"],"names":[],"mappings":";AAuVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"details.vue","sourceRoot":"src/views/goods","sourcesContent":["<template>\n  <div class=\"page_goods\" id=\"goods_details\">\n    <div class=\"warp\" v-if=\"$check_action('/goods/details', 'get')\">\n      <div class=\"container\">\n        <div class=\"row\">\n          <div class=\"col-12 col-md-10\">\n            <div class=\"pr-md-2\">\n              <!-- 商品详情 -->\n              <div class=\"card_div_goods\">\n                <div_goods :obj=\"obj\" :list_img=\"list_img\"></div_goods>\n              </div>\n              <div class=\"card_bottom_goods\">\n                <div class=\"options pl-3\">\n                  <span\n                    @click=\"selected_index = 1\"\n                    :class=\"{ selected: selected_index === 1 }\"\n                    >详情</span\n                  >\n                  <span\n                    @click=\"selected_index = 2\"\n                    :class=\"{ selected: selected_index === 2 }\"\n                    >评论</span\n                  >\n                </div>\n                <div v-if=\"selected_index === 2\" class=\"comment_box\">\n                  <list_comment\n                    class=\"w-100\"\n                    :list=\"list_comment\"\n                    :obj=\"form_comment\"\n                  ></list_comment>\n\n                  <!-- 分页器 -->\n                  <b-pagination-nav\n                    :base-url=\"$route.path\"\n                    :number-of-pages=\"count_pages\"\n                    :link-gen=\"link_gen\"\n                    @change=\"change_page\"\n                    first-number\n                    last-number\n                  ></b-pagination-nav>\n\n\n                  <div class=\"form_editor\">\n                    <div class=\"fl ml-3\" v-show=\"form_comment.reply_to_id\">\n                      对 <i>{{ respondent }}</i> 回复\n                    </div>\n                    <div class=\"fr mr-3\" v-show=\"form_comment.reply_to_id\">\n                      <b-button\n                        variant=\"outline-primary\"\n                        size=\"sm\"\n                        @click=\"form_comment.reply_to_id = 0\"\n                        >重置回复人</b-button\n                      >\n                    </div>\n                    <form_editor\n                      class=\"fn\"\n                      :form=\"form_comment\"\n                      :publish_flag = \"publish_flag\"\n                      @update_comment=\"update_comment\"\n                    ></form_editor>\n                  </div>\n                </div>\n\n                <div class=\"goods_desc_box\" v-else>\n                  <div class=\"goods_detail_item\" v-for=\"o in customize_field_list()\" :key=\"o\">\n                    <label>{{o.field_name+\" : \"}}</label>\n                    <span v-if=\"o.type==='image'\">\n                                            <img style=\"height: 150px\" :src=\"$fullUrl(o.field_value)\" v-if=\"o.field_value\" />\n                                        </span>\n                    <span v-else-if=\"o.type==='video'\">\n                                            <router-link :to=\"'/media/video?filename=' + $fullUrl(o.field_value)\" v-if=\"o.field_value\" >\n                                                <span>\n                                                    查看视频\n                                                </span>\n                                            </router-link>\n                                        </span>\n                    <span v-else-if=\"o.type==='audio'\">\n\t\t\t\t\t\t\t                <audio v-if=\"o.field_value\" style=\"text-align: left\" :src=\"$fullUrl(o.field_value)\" controls></audio>\n                                        </span>\n                    <span v-else-if=\"o.type==='file'\">\n\t\t\t\t\t\t\t                <a :href=\"$fullUrl(o.field_value)\" v-if=\"o.field_value\" target=\"_blank\" style=\"color: rgb(64, 158, 255);\">点击下载</a>\n                                        </span>\n                    <span v-else-if=\"o.type==='date'\">\n\t\t\t\t\t\t\t                {{$toTime(o.field_value,\"yyyy-MM-dd\")}}\n                                        </span>\n                    <span v-else-if=\"o.type==='time'\">\n\t\t\t\t\t\t\t                {{$toTime(o.field_value,\"hh:mm:ss\")}}\n                                        </span>\n                    <span v-else-if=\"o.type==='datetime'\">\n\t\t\t\t\t\t\t                {{$toTime(o.field_value,\"yyyy-MM-dd hh:mm:ss\")}}\n                                        </span>\n                    <span v-else>{{o.field_value}}</span>\n                  </div>\n                  <div class=\"goods_detail_editor\" v-html=\"obj.content\"></div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"col-12 col-md-2\">\n            <div class=\"card_aside\">\n              <h5>今日推荐</h5>\n              <list_goods_hot :list=\"list_hot\"></list_goods_hot>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport mixin from \"../../mixins/page.js\";\nimport list_goods_hot from \"../../components/diy/list_goods_hot.vue\";\nimport list_comment from \"../../components/diy/list_comment.vue\";\nimport div_goods from \"../../components/diy/div_goods.vue\";\nimport form_editor from \"../../components/diy/form_editor.vue\";\nexport default {\n  mixins: [mixin],\n  components: {\n    list_comment,\n    list_goods_hot,\n    div_goods,\n    form_editor,\n  },\n  data() {\n    return {\n      url_get_obj: \"~/api/goods/get_obj?\",\n      query: {\n        goods_id: 0,\n      },\n      list_comment: [],\n      list_hot: [],\n      selected_index: 2,\n      form_comment: {\n        source_table: \"goods\",\n        source_field: \"goods_id\",\n        source_id: 0,\n        reply_to_id: 0,\n        content:''\n      },\n      // 页面数\n      count_pages: 1,\n      // 是否设置过\n      seted_count_pages: true,\n      obj: {\n        goods_id: 0,\n        title: \"\",\n        img: \"\",\n        description: \"\",\n        price_ago: 0,\n        price: 0,\n        sales: 0,\n        inventory: 0,\n        type: \"\",\n        hits: 0,\n        content: '',\n        create_time: \"2021-02-20 20:48:07\",\n        update_time: \"2021-03-30 17:48:07\",\n        img_1: \"\",\n        img_2: \"\",\n        img_3: \"\",\n        img_4: \"\",\n        img_5: \"\",\n        source_table: \"\",\n        source_field: \"\",\n        source_id: 0,\n        num_buy: 1,\n        customize_field:\"\",\n        user_id:0\n      },\n      publish_flag:false\n    };\n  },\n  methods: {\n    /**\n     * 获取评论后\n     * @param {Object} json 响应对象\n     */\n    get_obj_after(json) {\n      var obj = json.result.obj;\n      this.get_comment(obj);\n      obj.num_buy = 1;\n      this.form_comment.source_id = obj.goods_id;\n      this.$get(\"~/api/order/get_obj?\", {\"goods_id\":obj.goods_id,\"user_id\":this.$store.state.user.user_id,\"state\":\"已付款\"}, (json) => {\n        if (json.result && json.result.obj) {\n          this.publish_flag = true\n        }\n      })\n    },\n    /**\n     * 获得热门商品\n     */\n    get_hot_goods() {\n      this.$get(\n        \"~/api/goods/get_list\",\n        {\n          page: 1,\n          size: 5,\n          orderby: \"hits\",\n        },\n        (res) => {\n          if (res.result) {\n            this.list_hot = res.result.list;\n          }\n        }\n      );\n    },\n    /**\n     * 更新评论\n     */\n    update_comment() {\n      this.get_comment(this.obj);\n    },\n\n    /**\n     * 获取评论\n     * @param { Object } obj 文章对象\n     * @param { Number } page 分页数\n     * @param { Number } size 评论显示条数\n     */\n    get_comment(obj, page = 1, size = 5) {\n      this.$get(\n        \"~/api/comment/get_list?\",\n        {\n          source_table: \"goods\",\n          source_field: \"goods_id\",\n          source_id: obj.goods_id,\n          page,\n          size,\n          orderby: \"create_time desc\",\n          reply_to_id: \"0\",\n        },\n        (json) => {\n          if (json.result) {\n            var list_comment = json.result.list;\n            list_comment.map(o=>{\n              o.list_reply = []\n            })\n            this.add_reply(list_comment).then((list) => {\n              this.list_comment = list;\n            });\n            // 分页器\n            if (this.seted_count_pages) {\n              this.seted_count_pages = false;\n              this.count_pages = Math.ceil(json.result.count / size);\n            }\n          }\n        }\n      );\n    },\n    /**\n     * @param { Array } list 评论列表\n     * 添加回复到评论列表\n     */\n    add_reply(list) {\n      return new Promise((resolve) => {\n        for (let idx = 0; idx < list.length; idx++) {\n          const obj = list[idx];\n          this.$get(\n            \"~/api/comment/get_list?\",\n            {\n              source_table: \"goods\",\n              source_field: \"goods_id\",\n              source_id: obj.goods_id,\n              orderby: \"create_time desc\",\n              reply_to_id: obj.comment_id,\n            },\n            (res) => {\n              if (res.result) {\n                obj.list_reply = res.result.list;\n              }\n            }\n          );\n        }\n        resolve(list);\n      });\n    },\n    /**\n     * 分页器\n     * @param { Number } page_num 分页数\n     * @return { Object } 查询对象\n     */\n    link_gen(page_num) {\n      return {\n        query: this.query,\n      };\n    },\n    /**\n     * 加载下一页\n     */\n    change_page(page_num) {\n      this.get_comment(this.obj, page_num);\n      this.form_comment.reply_to_id = 0;\n    },\n    // 获得商品轮播图\n    customize_field_list: function() {\n      if (this.obj.customize_field) {\n        let list_fields = JSON.parse(this.obj.customize_field)\n        return list_fields;\n      }\n      return []\n    }\n  },\n  computed: {\n    /**\n     * 获得图片列表\n     */\n    list_img() {\n      var { img_1, img_2, img_3, img_4 } = this.obj;\n      var list_img = [];\n      if (img_1) {\n        list_img.push(img_1);\n      }\n      if (img_2) {\n        list_img.push(img_2);\n      }\n      if (img_3) {\n        list_img.push(img_3);\n      }\n      if (img_4) {\n        list_img.push(img_4);\n      }\n      return list_img;\n    },\n    respondent() {\n      var reply_to_id = this.form_comment.reply_to_id;\n      var respondent = \"\";\n      this.list_comment.map((o) => {\n        if (o.comment_id === reply_to_id) {\n          respondent = o.nickname;\n        }\n      });\n      return respondent;\n    },\n  },\n  mounted() {\n    this.get_hot_goods();\n  },\n};\n</script>\n\n<style scoped>\n.card_bottom_goods {\n  margin-top: 60px;\n  padding: 5px;\n  border: 1px solid #eee;\n}\n.options {\n  font-size: 20px;\n  padding: 15px 0;\n  border-bottom: 1px solid #eee;\n}\n.options span {\n  cursor: pointer;\n  padding-right: 40px;\n  font-weight: 600;\n}\n.options span.selected {\n  color: var(--color_primary);\n}\n.options span:hover {\n  color: var(--color_primary);\n}\n.form_editor {\n  padding: 10px;\n}\n.comment_box {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n</style>\n"]}]}